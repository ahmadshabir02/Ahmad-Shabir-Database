<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¹Ù…Ø± Ø§Ù„ØµÙØ§Ø¡ O.P.D Ù…Ø¯Ø±ÛŒØª Ù…Ø§Ù„ÛŒ Ú©Ù„ÛŒÙ†ÛŒÚ©</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<style>
body { font-family: Vazirmatn, sans-serif; direction: rtl; text-align: right; margin: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #444; padding: 6px; text-align: center; }
th { background-color: #eee; }
input, button { margin: 5px; padding: 6px; }
#filters { margin-bottom: 10px; }
</style>
</head>
<body>
<h2>Ø¹Ù…Ø± Ø§Ù„ØµÙØ§Ø¡ O.P.D Ù…Ø¯Ø±ÛŒØª Ù…Ø§Ù„ÛŒ Ú©Ù„ÛŒÙ†ÛŒÚ©</h2>

<div>
  <button onclick="addIncome()">â• Ø«Ø¨Øª Ù¾ÙˆÙ„ Ø§Ø² Ø±ÛŒØ§Ø³Øª</button>
  <button onclick="addExpense()">â– Ø«Ø¨Øª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ</button>
  <button onclick="exportPDF()">ğŸ“„ Ø®Ø±ÙˆØ¬ÛŒ PDF</button>
  <button onclick="clearAll()">ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
</div>

<div id="filters">
  <input type="text" id="searchPerson" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø³Ù… Ø´Ø®Øµ" oninput="applyFilters()">
  <input type="text" id="searchDesc" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ø±Ø­" oninput="applyFilters()">
  <label>Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
  <input type="date" id="startDate" onchange="applyFilters()">
  <label>ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
  <input type="date" id="endDate" onchange="applyFilters()">
</div>

<table id="financeTable">
<thead>
<tr>
<th>#</th>
<th>ØªØ§Ø±ÛŒØ®</th>
<th>Ø³Ø§Ø¹Øª</th>
<th>Ø´Ø±Ø­</th>
<th>Ø´Ø®Øµ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒâ€ŒÚ©Ù†Ù†Ø¯Ù‡</th>
<th>Ù…Ø¨Ù„Øº (AFN)</th>
<th>Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ (AFN)</th>
<th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
let balance = 0;
let tableBody = document.querySelector("#financeTable tbody");

function addIncome() {
  let amount = prompt("Ù…Ø¨Ù„Øº Ù¾ÙˆÙ„ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
  if (amount) {
    balance += parseInt(amount);
    addRow("Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø² Ø±ÛŒØ§Ø³Øª", "Ø±ÛŒØ§Ø³Øª", amount);
  }
}

function addExpense() {
  let amount = prompt("Ù…Ø¨Ù„Øº Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
  let person = prompt("Ø§Ø³Ù… Ø´Ø®Øµ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù†Ù†Ø¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
  if (amount && person) {
    balance -= parseInt(amount);
    addRow("Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ", person, amount);
  }
}

function addRow(desc, person, amount) {
  let row = document.createElement("tr");
  row.innerHTML = `
    <td>${tableBody.rows.length + 1}</td>
    <td>${new Date().toLocaleDateString()}</td>
    <td>${new Date().toLocaleTimeString()}</td>
    <td>${desc}</td>
    <td>${person}</td>
    <td>${amount}</td>
    <td>${balance}</td>
    <td><button onclick="this.closest('tr').remove()">âŒ Ø­Ø°Ù</button></td>
  `;
  tableBody.appendChild(row);
}

function clearAll() {
  if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒ Ú©Ù‡ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´ÙˆÙ†Ø¯ØŸ")) {
    tableBody.innerHTML = "";
    balance = 0;
  }
}

function exportPDF() {
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();
  doc.text("Ø¹Ù…Ø± Ø§Ù„ØµÙØ§Ø¡ O.P.D Ù…Ø¯Ø±ÛŒØª Ù…Ø§Ù„ÛŒ Ú©Ù„ÛŒÙ†ÛŒÚ©", 10, 10);
  doc.autoTable({ html: "#financeTable" });
  doc.save("report.pdf");
}

function applyFilters() {
  let personFilter = document.getElementById("searchPerson").value;
  let descFilter = document.getElementById("searchDesc").value;
  let startDate = document.getElementById("startDate").value;
  let endDate = document.getElementById("endDate").value;

  Array.from(tableBody.rows).forEach(row => {
    let person = row.cells[4].innerText;
    let desc = row.cells[3].innerText;
    let date = row.cells[1].innerText;

    let visible = true;
    if (personFilter && !person.includes(personFilter)) visible = false;
    if (descFilter && !desc.includes(descFilter)) visible = false;
    if (startDate && new Date(date) < new Date(startDate)) visible = false;
    if (endDate && new Date(date) > new Date(endDate)) visible = false;

    row.style.display = visible ? "" : "none";
  });
}
</script>
</body>
</html>
